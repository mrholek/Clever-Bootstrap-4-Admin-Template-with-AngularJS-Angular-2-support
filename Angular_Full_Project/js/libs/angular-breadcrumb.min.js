!function(e,t,r){"use strict";function n(e,r){return t.equals(e.length,r.length)?e>r:e.length>r.length}function a(e){var t=e.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!t||4!==t.length)throw new Error("Invalid state ref '"+e+"'");return{state:t[1],paramExpr:t[3]||null}}function c(){var e={prefixStateName:null,template:"bootstrap3",templateUrl:null,includeAbstract:!1};this.setOptions=function(r){t.extend(e,r)},this.$get=["$state","$stateParams","$rootScope",function(t,c,u){var i=u;u.$on("$viewContentLoaded",function(e){!e.targetScope.ncyBreadcrumbIgnore&&n(e.targetScope.$id,i.$id)&&(i=e.targetScope)});var o=function(e){var t=e.parent||(/^(.+)\.[^.]+$/.exec(e.name)||[])[1],r="object"==typeof t;return r?t.name:t},s=function(r,n){for(var u,o,s=a(n),l=!1,p=!1,m=0,b=r.length;m<b;m+=1)if(r[m].name===s.state)return;u=t.get(s.state),u.ncyBreadcrumb&&(u.ncyBreadcrumb.force&&(l=!0),u.ncyBreadcrumb.skip&&(p=!0)),u.abstract&&!e.includeAbstract&&!l||p||(s.paramExpr&&(o=i.$eval(s.paramExpr)),u.ncyBreadcrumbLink=t.href(s.state,o||c||{}),r.unshift(u))},l=function(e){var r=a(e),n=t.get(r.state);if(n.ncyBreadcrumb&&n.ncyBreadcrumb.parent){var c="function"==typeof n.ncyBreadcrumb.parent,u=c?n.ncyBreadcrumb.parent(i):n.ncyBreadcrumb.parent;if(u)return u}return o(n)};return{getTemplate:function(t){return e.templateUrl?null:t[e.template]?t[e.template]:e.template},getTemplateUrl:function(){return e.templateUrl},getStatesChain:function(r){for(var n=[],a=t.$current.self.name;a;a=l(a))if(s(n,a),r&&n.length)return n;return e.prefixStateName&&s(n,e.prefixStateName),n},getLastStep:function(){var e=this.getStatesChain(!0);return e.length?e[0]:r},$getLastViewScope:function(){return i}}}]}function u(e,r,n){var a={bootstrap2:'<ul class="breadcrumb"><li ng-repeat="step in steps" ng-switch="$last || !!step.abstract" ng-class="{active: $last}"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span><span class="divider" ng-hide="$last">/</span></li></ul>',bootstrap3:'<ol class="breadcrumb"><li ng-repeat="step in steps" ng-class="{active: $last}" ng-switch="$last || !!step.abstract"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span></li></ol>'};return{restrict:"AE",replace:!0,scope:{},template:r.getTemplate(a),templateUrl:r.getTemplateUrl(),link:{post:function(a){var c=[],u=function(){p(c),c=[];var n=r.$getLastViewScope();a.steps=r.getStatesChain(),t.forEach(a.steps,function(t){if(t.ncyBreadcrumb&&t.ncyBreadcrumb.label){var r=e(t.ncyBreadcrumb.label);t.ncyBreadcrumbLabel=r(n),l(c,r,n,t)}else t.ncyBreadcrumbLabel=t.name})};n.$on("$viewContentLoaded",function(e){e.targetScope.ncyBreadcrumbIgnore||u()}),u()}}}}function i(e,t,r){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbLabel}}",compile:function(n,a){var c=n.attr(a.$attr.ncyBreadcrumbLast);return c&&n.html(c),{post:function(n){var a=[],c=function(){p(a),a=[];var r=t.$getLastViewScope(),c=t.getLastStep();if(c)if(n.ncyBreadcrumbLink=c.ncyBreadcrumbLink,c.ncyBreadcrumb&&c.ncyBreadcrumb.label){var u=e(c.ncyBreadcrumb.label);n.ncyBreadcrumbLabel=u(r),l(a,u,r,n)}else n.ncyBreadcrumbLabel=c.name};r.$on("$viewContentLoaded",function(e){e.targetScope.ncyBreadcrumbIgnore||c()}),c()}}}}}function o(e,r,n){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbChain}}",compile:function(a,c){var u=a.attr(c.$attr.ncyBreadcrumbText);u&&a.html(u);var i=a.attr(c.$attr.ncyBreadcrumbTextSeparator)||" / ";return{post:function(a){var c=[],u=function(e,r,n){t.forEach(s(r),function(t){var r=n.$watch(t,function(e,t){e!==t&&o()});e.push(r)})},o=function(){p(c),c=[];var n=r.$getLastViewScope(),o=r.getStatesChain(),s=[];t.forEach(o,function(t){if(t.ncyBreadcrumb&&t.ncyBreadcrumb.label){var r=e(t.ncyBreadcrumb.label);s.push(r(n)),u(c,r,n)}else s.push(t.name)}),a.ncyBreadcrumbChain=s.join(i)};n.$on("$viewContentLoaded",function(e){e.targetScope.ncyBreadcrumbIgnore||o()}),o()}}}}}var s=function(e){if(e.expressions)return e.expressions;var r=[];return t.forEach(e.parts,function(e){t.isFunction(e)&&r.push(e.exp)}),r},l=function(e,r,n,a){t.forEach(s(r),function(t){var c=n.$watch(t,function(){a.ncyBreadcrumbLabel=r(n)});e.push(c)})},p=function(e){t.forEach(e,function(e){e()})};u.$inject=["$interpolate","$breadcrumb","$rootScope"],i.$inject=["$interpolate","$breadcrumb","$rootScope"],o.$inject=["$interpolate","$breadcrumb","$rootScope"],t.module("ncy-angular-breadcrumb",["ui.router.state"]).provider("$breadcrumb",c).directive("ncyBreadcrumb",u).directive("ncyBreadcrumbLast",i).directive("ncyBreadcrumbText",o)}(window,window.angular);